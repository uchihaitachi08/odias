<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Odia Dictionary Search</title>
	<!-- Canonical URL -->
  <link rel="canonical" href="https://www.odiagames.in/" />
<!-- Redirect apex -> www early to avoid flicker -->
  <script>
    (function () {
      if (location.hostname === 'odiagames.in') {
        location.replace('https://www.odiagames.in' + location.pathname + location.search + location.hash);
      }
    })();
  </script>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{ --fg:#111; --muted:#666; --border:#e6e6e6; --bg:#fff; --radius:12px; }
    *{ box-sizing:border-box }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial; margin:0; color:var(--fg); background:var(--bg); }
    header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 16px; border-bottom:1px solid var(--border); position:sticky; top:0; background:var(--bg); z-index:10; }
    .brand{ font-weight:800; letter-spacing:-.2px; font-size:clamp(18px,3.2vw,22px); }
    .right{ display:flex; align-items:center; gap:10px; }
    button{ height:40px; padding:0 12px; border-radius:10px; border:1px solid var(--border); background:#f7f7f7; cursor:pointer; font-size:14px }
    button:active{ transform: translateY(0.5px); }
    .avatar{ width:32px; height:32px; border-radius:50%; object-fit:cover; border:1px solid var(--border); display:none; }
    .who{ color:var(--muted); font-size:14px; }
    .wrap{ max-width:980px; margin:0 auto; padding:18px 16px; }
    .input { width: 100%; max-width: 640px; font-size: 1.05rem; padding: .7rem .9rem; border:1px solid var(--border); border-radius: 12px; }
    .input:focus{ outline:none; border-color:#c9c9c9; }
    .card { max-width: 980px; padding: 1rem 1.2rem; border: 1px solid var(--border); border-radius: var(--radius); margin-top: 12px; background:#fff; }
    .word { font-size: 1.6rem; font-weight: 700; }
    .trans { color:#555; margin-top:.2rem }
    .desc { margin-top:.6rem; line-height:1.6 }
    .muted { color:#888 }
    .flex{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    @media (prefers-color-scheme: dark){
      :root{ --fg:#eaeaea; --muted:#aaa; --border:#2a2a2a; --bg:#0f0f0f; }
      .card, button { background:#141414; }
      .input{ background:#111; color:var(--fg); border-color:var(--border); }
      header{ background:#0f0f0f; }
    }
  </style>
</head>
<body>
<header>
  <div class="brand">Odia Dictionary</div>
  <nav style="display:flex; gap:16px; align-items:center; font-size:15px;">
    <a href="index.html" style="text-decoration:none; color:var(--fg);">Home</a>
    <a href="pick-verbs.html" style="text-decoration:none; color:var(--fg);">Pick Verbs</a>
  </nav>
  <div class="right">
    <img id="avatar" class="avatar" alt="avatar" />
    <span id="whoami" class="who"></span>
    <button id="btn-google">Sign in with Google</button>
    <button id="btn-logout" style="display:none;">Log out</button>
  </div>
</header>

  <div class="wrap">
    <div class="flex">
      <input id="q" class="input" placeholder="Type Odia word (e.g., à¬¨à¬¬à¬®à­€) or entity (e.g., &#28397;)" />
      <span id="status" class="muted">Loading dictionaryâ€¦</span>
    </div>
    <div id="result" class="card muted">Type a word to searchâ€¦</div>
  </div>

  <!-- Search + normalization (inlined to avoid external import issues) -->
  <script type="module">
    console.log('Search module loaded');

    // ---- Normalization helpers (inline) ----
    const SPACE_RE = /[\u0009-\u000D\u0020\u00A0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]+/g;
    const ZERO_WIDTH_RE = /[\u200B\u200C\u200D\u2060\uFEFF]/g;

    function decodeHtmlEntities(s) {
      if (!/[&][#\w]+;/.test(s)) return s;
      const ta = document.createElement('textarea'); ta.innerHTML = s; return ta.value;
    }
    function decodeUnicodeEscapes(s) {
      if (!/\\u[0-9a-fA-F]{4}/.test(s)) return s;
      try { return JSON.parse('"' + s.replace(/"/g, '\\"') + '"'); } catch { return s; }
    }
    function normalizeInput(input) {
      let s = String(input ?? '');
      s = decodeHtmlEntities(s);
      s = decodeUnicodeEscapes(s);
      s = s.replace(ZERO_WIDTH_RE, '');
      s = s.trim();
      if (s.normalize) s = s.normalize('NFC');
      return s;
    }
    function isOdiaWord(s) {
      s = normalizeInput(s);
      return /[\u0B00-\u0B7F]/.test(s);
    }
    function normalizeExact(s) {
      s = normalizeInput(s);
      return s.replace(SPACE_RE,' ').trim().normalize('NFC');
    }
    function normalizeCompact(s) {
      s = normalizeInput(s);
      return s.replace(SPACE_RE,'').normalize('NFC');
    }

    // ---- Dictionary + indexes ----
    let dict = [];
    const indexExact = new Map();
    const indexCompact = new Map();

    const statusEl = document.getElementById('status');
    const resultEl = document.getElementById('result');
    const qEl = document.getElementById('q');

    function buildIndex(data){
      indexExact.clear(); indexCompact.clear();
      for (const e of data) {
        if (!e.word) continue;
        const k1 = normalizeExact(e.word);
        const k2 = normalizeCompact(e.word);
        (indexExact.get(k1) || indexExact.set(k1, []).get(k1)).push(e);
        (indexCompact.get(k2) || indexCompact.set(k2, []).get(k2)).push(e);
      }
    }

    function render(entries, query) {
      if (!entries || entries.length === 0) {
        resultEl.innerHTML = `<div class="muted">No match found for: <b>${query}</b></div>`;
        return;
      }
      const blocks = entries.slice(0, 20).map(e => `
        <div class="word">${e.word ?? ''}</div>
        ${e.transliteration ? `<div class="trans">${e.transliteration}</div>` : ''}
        ${e.description ? `<div class="desc">${e.description}</div>` : ''}
        <div class="muted">page ${e.page}</div>
        <hr style="border:none;border-top:1px dashed var(--border);margin:1rem 0" />
      `).join('');
      resultEl.innerHTML = `<div>${blocks}</div>`;
    }

    // Load dictionary
    fetch('./dictionary.json')
      .then(r => r.json())
      .then(data => {
        dict = data;
        buildIndex(dict);
        statusEl.textContent = 'Dictionary loaded.';
      })
      .catch(err => {
        console.error(err);
        statusEl.textContent = 'Failed to load dictionary.json';
      });

    // Search handler
    let timer;
    qEl.addEventListener('input', () => {
      clearTimeout(timer);
      const raw = qEl.value;
      if (!raw.trim()) { resultEl.innerHTML = `<div class="muted">Type a word to searchâ€¦</div>`; return; }
      timer = setTimeout(() => {
        const normalized = normalizeInput(raw);
        if (!isOdiaWord(normalized)) {
  resultEl.innerHTML = `
  		<div style="display:flex;align-items:center;justify-content:center;height:100%;">
      <img src="ErrorText.svg" alt="ðŸ™‚" style="max-width:50%;max-height:50%;object-fit:contain;">
    </div>
	`;
  return;
}
	const k1 = normalizeExact(raw);
        let entries = indexExact.get(k1);
        if (!entries || entries.length === 0) {
          const k2 = normalizeCompact(raw);
          entries = indexCompact.get(k2) || [];
        }
        render(entries, normalized);
      }, 150);
    });
  </script>

  <!-- Firebase Auth (placed AFTER the header markup so buttons exist) -->
  <script type="module">
    console.log('Auth module loaded');

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect,
      onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAMN7iDvBV5jMXefdlrXX1K-g1W4kFar7Y",
      authDomain: "odiagames.firebaseapp.com",
      projectId: "odiagames",
      storageBucket: "odiagames.firebasestorage.app",
      messagingSenderId: "975806732824",
      appId: "1:975806732824:web:52f193988fd672625ac16d",
      measurementId: "G-PS543VSGW7"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(_) {}

    const btnGoogle = document.getElementById('btn-google');
    const btnLogout = document.getElementById('btn-logout');
    const whoami = document.getElementById('whoami');
    const avatar = document.getElementById('avatar');

    const auth = getAuth(app);
    auth.useDeviceLanguage();
    const provider = new GoogleAuthProvider();

    btnGoogle.addEventListener('click', async () => {
      try { await signInWithPopup(auth, provider); }
      catch { await signInWithRedirect(auth, provider); }
    });
    btnLogout.addEventListener('click', () => signOut(auth));

    onAuthStateChanged(auth, (user) => {
      if (user) {
        const name = user.displayName || user.email || "Signed in";
        whoami.textContent = name;
        if (user.photoURL) { avatar.src = user.photoURL; avatar.style.display = 'inline-block'; }
        else { avatar.style.display = 'none'; }
        btnGoogle.style.display = 'none';
        btnLogout.style.display = 'inline-block';
      } else {
        whoami.textContent = "";
        avatar.style.display = 'none';
        btnGoogle.style.display = 'inline-block';
        btnLogout.style.display = 'none';
      }
    });
  </script>
</body>
</html>

